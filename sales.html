<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ventas</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="ventas.css">
</head>
<body>
  <header>
    <h1>Gestión de Ventas</h1>
    <nav>
      <a href="menu.html">Volver al Menú</a>
    </nav>
  </header>
  <main>
    <section>
      <h2>Productos para Venta</h2>
      <ul id="sales-stock"></ul>

      <form id="add-product-form">
        <h3>Crear Producto</h3>
        <input type="text" id="product-name" placeholder="Nombre del producto" required>
        <input type="number" id="product-price" placeholder="Precio unitario" required>
        <input type="number" id="product-quantity" placeholder="Cantidad inicial" required>
        <button type="submit">Agregar Producto</button>
      </form>

      <h3>Carrito de Pedido</h3>
      <ul id="cart-list"></ul>
      <button id="finalize-sale">Finalizar Venta</button>
    </section>
  </main>

  <script>
    let salesStock = JSON.parse(localStorage.getItem('salesStock')) || [];
    let salesHistory = JSON.parse(localStorage.getItem('salesHistory')) || [];
    let cart = []; // Carrito temporal

    // Renderizar productos en el stock
    function renderSalesStock() {
      const salesList = document.getElementById('sales-stock');

      salesList.innerHTML = '';

      salesStock.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          ${item.name} - ${item.quantity} unidades disponibles - $${item.price}
        `;
        salesList.appendChild(li);
      });
    }

    // Renderizar carrito
    function renderCart() {
      const cartList = document.getElementById('cart-list');
      cartList.innerHTML = '';

      if (cart.length === 0) {
        cartList.innerHTML = '<li>El carrito está vacío.</li>';
        return;
      }

      cart.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          ${item.name} - ${item.quantity} unidades a $${item.price} c/u
        `;
        cartList.appendChild(li);
      });
    }

    // Finalizar venta
    document.getElementById('finalize-sale').addEventListener('click', function () {
      if (cart.length === 0) {
        alert('El carrito está vacío.');
        return;
      }

      const totalAmount = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const saleId = `order-${Date.now()}`;

      salesHistory.push({
        id: saleId,
        totalAmount,
        date: new Date().toLocaleString(),
        items: [...cart],
      });

      localStorage.setItem('salesHistory', JSON.stringify(salesHistory));

      alert(`Venta registrada exitosamente. ID de la venta: ${saleId}`);
      window.location.href = `boleta.html?id=${saleId}`; // Redirigir a la boleta
    });

    renderSalesStock();
  </script>
</body>
</html>
